/*! Copyright (c) 2018 Abu Dzakiyyah (https://abu.dzakiyyah.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version: 1.2
 *
 */
$(document).ajaxStart(function(){Pace.restart()});function contentAutoHeight(h){var d=h.element,a=h.scroll,e=h.drag,b=h.substract,g=h.plugin,c="";var f=$(document).height()-b;if(g==="niceScroll"){$(d).attr("style","height:"+f+"px;");if(e===true){c={touchbehavior:true,usetransition:true,hwacceleration:true}}else{c=""}if(a===true){$(d).niceScroll(c)}}else{if(g==="slimScroll"){$(window).resize(function(){var i=$(window).height()-(b+7);$(d).height(i);$(d).parent(".slimScrollDiv").height(i+7)});$(d).slimScroll({height:f,wheelStep:10,touchScrollStep:75,size:"4px",distance:"2px",railVisible:true})}else{console.log("No Plugin")}}}function getNext(){var a=$(".mainNav>ul>li.active").next();a.find("a").click()}function getPrev(){var a=$(".mainNav>ul>li.active").prev();a.find("a").click()}function initCloseTab(){$("span.closeTab").click(function(){var c=$(this).parents("li a"),e=c[0].hash,a=e.split("#"),d=$(this).parents("li.active").prev(),b=$(this).parents("li.active").next();$(this).parents("li").remove();$(e).remove();deleteData({key:"mainTabs",param:"tabId",find:a[1]});if(b.length===0){d.find("a").click()}else{b.find("a").click()}})}function renderPage(b,c){for(var a in c){b=b.replace("{{"+a+"}}",c[a])}return b}function ajaxServices(d){var c=d.module,b=d.form,g=d.data,e=d.action,a=d.method,i=d.type,f=d.request,h=d.target;if(a.toLowerCase()==="post"){$.post(e,g+"&request="+f,function(j){$(c).find(h).html(renderPage(j.views,j.content))},"json");$(c).find(b).find("[type=submit]").button("reset")}else{if(a.toLowerCase()==="get"){$.get(e,g,function(j){console.log(j);$(h).html(j)})}else{console.log("Method Not Found")}}}function loadURL(a,b,c){$.get(a,c,function(d){$(b).html(d);initializeForm()}).fail(function(){var d='<div class="error-page"><h2 class="headline text-yellow" style="margin-top: -25px; margin-bottom: 0;"> 404</h2><div class="error-content"><h3><i class="fa fa-warning text-yellow"></i> Oops! Terjadi Kesalahan...</h3><p>Sistem tidak dapat menemukan halaman yang anda akses, silahkan menghubungi Administrator untuk masalah ini.</p></div></div>';$(b).html(d)})}function restoreSettings(){var b=getData({key:"mainTabs"}),a=getData({key:"appSettings"});if(b!==null){restoreTabs(b)}else{pushData({key:"mainTabs",data:[{tabIndex:0,tabId:"home",tabUrl:"pages/home.html",tabTitle:"Beranda",tabIcon:"fa fa-home",tabDesc:"Selamat Datang Admin",tabStatus:"active"}]});tabTrigger("a[href='#home']");$("a[href='#home']").tab("show");loadURL("pages/home.html","#homeContent")}if(a!==null){if(a[0].sidebar==="sidebar-collapse"){$("body").addClass(a[0].sidebar)}else{$("body").removeClass(a[0].sidebar)}if(a[0].skin!==null){$("body").addClass(a[0].skin)}}}function restoreTabs(e){var d=$(".mainNav ul.nav"),f=$(".mainNav div.tab-content"),h="",c="",b="",g="",a="";$.each(e,function(k,l){if(l.tabId!=="home"){var i=$(".subMenu[data-id='"+l.tabId+"']"),m=i.parents("li.treeview").find("span").html(),n=i.parents("li.treeview").find("i").attr("class");h='<li data-index="'+l.tabIndex+'"><a href="#'+l.tabId+'" data-toggle="tab" title="'+l.tabDesc+'"><i class="'+l.tabIcon+'"></i> '+l.tabTitle+' <span class="closeTab" title="Close Tab"><i class="fa fa-times"></i></span></a></li>';c='<div class="tab-pane" id="'+l.tabId+'"><section class="content-header"><h1>'+m+"<small>"+l.tabDesc+'</small></h1><ol class="breadcrumb"><li><a><i class="'+n+'"></i> '+m+'</a></li><li class="active">'+l.tabTitle+'</li></ol></section><section id="'+l.tabId+'Content" class="content text-justify mainContent  animated fadeIn"></section></div>'}d.append(h);f.append(c);if(l.tabStatus==="active"){b=l.tabId;g=l.tabUrl}else{var j=$("#"+l.tabId+"Content.mainContent");a='<div class="error-page"><div class="error-content text-center" style="margin-left: 0;"><h3><i class="fa fa-info-circle text-primary"></i> Mode penghemat daya aktif...</h3><p>Anda telah merefresh browser, Silahkan tekan tombol reload untuk memuat halaman<br><br><button class="btn btn-primary" onclick="restoreContent(\''+l.tabId+"','"+l.tabUrl+'\');" data-toggle="tooltip" title="Tekan untuk reload halaman" data-container=".tab-content" ><i class="fa fa-spinner fa-spin"></i> Reload</button></p></div></div>';j.append(a);j.addClass("reload")}tabTrigger("a[href='#"+l.tabId+"']");contentAutoHeight({element:"#"+l.tabId+"Content",scroll:true,drag:false,substract:170,plugin:"slimScroll"})});initCloseTab();initDynamicTab();$("a[href='#"+b+"']").tab("show");loadURL(g,"#"+b+"Content")}function restoreContent(b,a){contentAutoHeight({element:"#"+b+"Content",scroll:true,drag:false,substract:170,plugin:"slimScroll"});loadURL(a,"#"+b+"Content");$("#"+b+"Content").removeClass("animated fadeIn").width("auto").addClass("animated fadeIn")}function buildTabs(b){var g=$(".mainNav>ul.nav"),i=$(".mainNav>div.tab-content"),l=$(b.parentMenu).find("i").attr("class")===undefined?b.parentIcon:$(b.parentMenu).find("i").attr("class"),e=$(b.parentMenu).find("span").html()===undefined?b.parentMenu:$(b.parentMenu).find("span").html(),c=g.find("a[href='#"+b.id+"']"),f=g.find("li:last-child").attr("data-index"),j=parseInt(f)+1,h='<li data-index="'+j+'"><a href="#'+b.id+'" data-toggle="tab" title="'+b.desc+'"><i class="'+b.icon+'"></i> '+b.title+' <span class="closeTab" title="Close Tab"><i class="fa fa-times"></i></span></a></li>',d='<div class="tab-pane" id="'+b.id+'"></div>',k='<section class="content-header"><h1>'+e+"<small>"+b.desc+'</small></h1><ol class="breadcrumb"><li><a><i class="'+l+'"></i> '+e+'</a></li><li class="active">'+b.title+'</li></ol></section><section id="'+b.id+'Content" class="content text-justify mainContent  animated fadeIn"></section>';if(c.length<1){g.append(h);i.append(d);$("#"+b.id).append(k);pushData({key:"mainTabs",data:[{tabIndex:j,tabId:b.id,tabUrl:b.url,tabTitle:b.title,tabIcon:b.icon,tabDesc:b.desc,tabStatus:""}]});initCloseTab();contentAutoHeight({element:"#"+b.id+"Content",scroll:true,drag:false,substract:170,plugin:"slimScroll"});loadURL(b.url,"#"+b.id+"Content");initDynamicTab();tabTrigger("a[href='#"+b.id+"']");return true}else{var a=$("#"+b.id+"Content");if(a.hasClass("reload")===true){loadURL(b.url,"#"+b.id+"Content");a.removeClass("animated fadeIn").width("auto").addClass("animated fadeIn");a.removeClass("reload")}initDynamicTab();return false}}function tabTrigger(a){$(a).on("shown.bs.tab",function(){var b=parseInt($(this).parent("li").attr("data-index"));changeData({key:"mainTabs",findParam:"tabIndex",setParam:"tabStatus",find:b,setValue:"active:"})})}function initMenuClick(){$(".tb-skin td").click(function(){var a=$(this).find("img").attr("alt"),b=getData({key:"appSettings"});$("body").removeClass(b[0].skin).addClass(a);updateData({key:"appSettings",setParam:"skin",replace:true,setValue:a})});$(".sidebar-toggle").click(function(){var a=getData({key:"appSettings"});if($("body").delay(300).hasClass("sidebar-collapse")){if(a!==null){updateData({key:"appSettings",findParam:"sidebar",setParam:"sidebar",find:"sidebar-collapse",setValue:""})}else{pushData({key:"appSettings",data:[{sidebar:"",skin:"skin-blue"}]})}}else{if(a!==null){updateData({key:"appSettings",findParam:"sidebar",setParam:"sidebar",find:"",setValue:"sidebar-collapse"})}else{pushData({key:"appSettings",data:[{sidebar:"sidebar-collapse",skin:"skin-blue"}]})}}});$(".dropdown-menu li>.menu").slimScroll({height:"200px",size:"3px"});$(".subMenu").click(function(){var b={url:$(this).data("url"),id:$(this).data("id"),desc:$(this).data("desc"),parentMenu:$(this).parents("li.treeview").find("a"),icon:$(this).find("i").attr("class"),title:$(this).find("span").html()};var d=buildTabs(b);var c=$('.mainNav>ul>li>a[href="#'+b.id+'"]'),a=parseInt(c.parent("li").attr("data-index"));c.tab("show");if(d===false){changeData({key:"mainTabs",findParam:"tabIndex",setParam:"tabStatus",find:a,setValue:"active:"})}});$(".tabCreate").click(function(){var b={url:$(this).data("url"),id:$(this).data("id"),desc:$(this).data("desc"),parentMenu:$(this).data("parent"),parentIcon:$(this).data("parent-icon"),icon:$(this).data("icon"),title:$(this).data("title")};var d=buildTabs(b);var c=$('.mainNav>ul>li>a[href="#'+b.id+'"]'),a=parseInt(c.parent("li").attr("data-index"));c.tab("show");if(d===false){changeData({key:"mainTabs",findParam:"tabIndex",setParam:"tabStatus",find:a,setValue:"active:"})}})}function buildMenu(c){var e=c.menu,d=$("ul.sidebar-menu"),b="",a="";$.each(e,function(g,f){if(f.mainMenuChild===true){b+='<li class="treeview"><a><i class="'+f.mainMenuIcon+'"></i> <span class="mainTitle">'+f.mainMenuTitle+'</span><span class="pull-right-container"><i class="fa fa-angle-left pull-right"></i></span></a>';a='<ul class="treeview-menu">';$.each(f.mainMenuContent,function(i,h){a+='<li><a class="subMenu" data-url="'+h.subMenuUrl+'" data-id="'+h.subMenuId+'" data-desc="'+h.subMenuDesc+'"><i class="'+h.subMenuIcon+'"></i> <span>'+h.subMenuTitle+"</span></a></li>"});a+="</ul>"}else{b+='<li class="treeview"><a class="subMenu" data-url="'+f.mainMenuUrl+'" data-id="'+f.mainMenuId+'" data-desc="'+f.mainMenuDesc+'"><i class="'+f.mainMenuIcon+'"></i> <span>'+f.mainMenuTitle+"</span></a>"}b+=a+"</li>"});d.append(b)}function buildAppInfo(){var q=$.ajax({url:"app.json",type:"get",async:false,success:function(s){return s}}),g=q.responseJSON[0].AppName,d=q.responseJSON[0].AppDesc,e=q.responseJSON[0].AppVersion,n=q.responseJSON[0].AppLink,i=q.responseJSON[0].AppLogo,k=q.responseJSON[0].AppWebsite,j=q.responseJSON[0].AppAuthor,r=q.responseJSON[0].AuthorWebsite,o=q.responseJSON[0].DataContent[0].moduleData;var m=getData({key:"appInfo"}),a=getData({key:"moduleMenu"}),f=getData({key:"appSettings"}),p=$("body>.wrapper>.main-header>a"),h=$("body>.wrapper>.main-header>a>span.logo-lg"),l=$("body>.wrapper>.main-header>a>span.logo-mini"),b=$("footer.main-footer>div>span.version"),c=$("footer.main-footer>span.copyright>a");if(m===null){pushData({key:"appInfo",data:[{AppName:g,AppDesc:d,AppVersion:e,AppLink:n,AppLogo:i,AppWebsite:k,AppAuthor:j,AuthorWebsite:r}]});document.title=g+" | "+d;p.attr("href",n);h.html(g);l.html("<i class='fa fa-shopping-bag'></img>");b.html(e);c.html(j);c.attr("href",r)}else{if(e!==m[0].AppVersion){jConfirm("current: app.json("+m[0].AppVersion+")<br>new update: app.json("+e+")<br><br>Terdapat Update Setting, Update Sekarang?","Update Setting",function(s){if(s){pushData({replace:true,key:"appInfo",data:[{AppName:g,AppDesc:d,AppVersion:e,AppLink:n,AppLogo:i,AppWebsite:k,AppAuthor:j,AuthorWebsite:r}]});document.title=g+" | "+d;p.attr("href",n);h.html(g);l.html("<i class='fa fa-shopping-bag'></img>");b.html(e);c.html(j);c.attr("href",r)}else{document.title=m[0].AppName+" | "+m[0].AppDesc;p.attr("href",m[0].AppLink);h.html(m[0].AppName);l.html("<i class='fa fa-shopping-bag'></img>");b.html(m[0].AppVersion);c.html(m[0].AppAuthor);c.attr("href",m[0].AuthorWebsite)}})}else{document.title=m[0].AppName+" | "+m[0].AppDesc;p.attr("href",m[0].AppLink);h.html(m[0].AppName);l.html("<i class='fa fa-shopping-bag'></img>");b.html(m[0].AppVersion);c.html(m[0].AppAuthor);c.attr("href",m[0].AuthorWebsite)}}if(a===null){buildMenu({menu:o});pushData({key:"moduleMenu",data:o});pushData({key:"mainTabs",replace:true,data:[{tabIndex:0,tabId:"home",tabUrl:"pages/home.html",tabTitle:"Beranda",tabIcon:"fa fa-home",tabDesc:"Selamat Datang Admin",tabStatus:"active"}]});restoreSettings();initMenuClick()}else{if(JSON.stringify(o)!==JSON.stringify(a)){jConfirm("Terjadi perubahan struktur menu, Anda yakin akan <br> memuat konfigurasi menu yang baru?",g+" v. "+e,function(s){if(s){buildMenu({menu:o});pushData({key:"moduleMenu",data:o,replace:true});pushData({key:"mainTabs",replace:true,data:[{tabIndex:0,tabId:"home",tabUrl:"pages/home.html",tabTitle:"Beranda",tabIcon:"fa fa-home",tabDesc:"Selamat Datang Admin",tabStatus:"active"}]});restoreSettings();initMenuClick()}else{buildMenu({menu:a});restoreSettings();initMenuClick()}})}else{buildMenu({menu:a});restoreSettings();initMenuClick()}}if(f===null){pushData({key:"appSettings",data:[{sidebar:"",skin:"skin-blue"}]});$("body").addClass("skin-blue")}}function initializeForm(){$(".select2").each(function(a,b){$(b).select2().on("change",function(){if($(this).val()!==""){$(this).valid()}})});$("[data-fixedheight]").each(function(a,b){$(b).slimScroll($(b).data("fixedheight")[0])});$("[type=checkbox]").each(function(g,f){var n=$(f).data("style")!==undefined?$(f).data("style"):"",a=$(f).data("label-toggle")!==undefined?$(f).data("label-toggle"):"",c=$(f).data("label-type")!==undefined?$(f).data("label-type"):"",j="",o="",e="";if(a!==true||a===undefined){var k=$(f).data("label")!==undefined?$(f).data("label"):"",l=$(f).data("label-style")!==undefined?$(f).data("label-style"):"";if(c==="icon"){n+=" p-icon";j=$(f).data("label-icon")!==undefined?"<i class='icon "+$(f).data("label-icon")+"'></i>":""}else{if(c==="image"){n+=" p-image";j=$(f).data("label-icon")!==undefined?"<img src='"+$(f).data("label-icon")+"'/>":""}else{n+=" p-default";j=""}}if($(f).parent(".pretty").length<1){$(f).wrap('<div class="pretty '+n+'"></div>');$(f).after('<div class="state '+l+'">'+j+"<label>"+k+"</label></div>")}}else{var m=$(f).data("label-on")!==undefined?$(f).data("label-on"):"",h=$(f).data("label-off")!==undefined?$(f).data("label-off"):"",d=$(f).data("label-style-on")!==undefined?$(f).data("label-style-on"):"",b=$(f).data("label-style-off")!==undefined?$(f).data("label-style-off"):"";if(c==="icon"){n+=" p-icon p-toggle";o=$(f).data("label-icon-on")!==undefined?"<i class='icon "+$(f).data("label-icon-on")+"'></i>":"";e=$(f).data("label-icon-off")!==undefined?"<i class='icon "+$(f).data("label-icon-off")+"'></i>":""}else{if(c==="image"){n+=" p-image p-toggle";o=$(f).data("label-icon-on")!==undefined?"<img src='"+$(f).data("label-icon-on")+"'/>":"";e=$(f).data("label-icon-off")!==undefined?"<img src='"+$(f).data("label-icon-off")+"'/>":""}else{n+=" p-default";o="";e=""}}if($(f).parent(".pretty").length<1){$(f).wrap('<div class="pretty '+n+'"></div>');$(f).after('<div class="state '+d+' p-on">'+o+"<label>"+m+"</label></div>");$(f).after('<div class="state '+b+' p-off">'+e+"<label>"+h+"</label></div>")}}});$("[type=radio]").each(function(d,f){var a=$(f).data("style")!==undefined?$(f).data("style"):"",b=$(f).data("label-type")!==undefined?$(f).data("label-type"):"",g=$(f).data("label")!==undefined?$(f).data("label"):"",c=$(f).data("label-style")!==undefined?$(f).data("label-style"):"",e="";if(b==="icon"){a+=" p-icon";e=$(f).data("label-icon")!==undefined?"<i class='icon "+$(f).data("label-icon")+"'></i>":""}else{if(b==="image"){a+=" p-image";e=$(f).data("label-icon")!==undefined?"<img src='"+$(f).data("label-icon")+"'/>":""}else{a+=" p-default";e=""}}if($(f).parent(".pretty").length<1){$(f).wrap('<div class="pretty '+a+'"></div>');$(f).after('<div class="state '+c+'">'+e+"<label>"+g+"</label></div>")}});$("textarea[data-autoheight=true]").each(function(b,c){var a=$(c).data("autoheight-shift")!==undefined?$(c).data("autoheight-shift"):false;if(a===true){$(c).keydown(function(d){if(d.keyCode===13&&!d.shiftKey){d.preventDefault()}else{autosize($(c))}})}else{autosize($(c))}});$("form[data-service=ajax]").each(function(c,b){var k=$(b).attr("action"),e=$(b)[0].method,j=$(b)[0].name,a=$(b).data("target"),d=$(b).data("type"),f=$(b).data("request"),h="#"+$(b)[0].id,g="#"+$(h).parents(".mainContent")[0].id;$(b).validate({submitHandler:function(){$(b).find("[type=submit]").button("loading");var i=$(b).serialize();ajaxServices({module:g,form:h,action:k,method:e,target:a,request:f,type:d,data:i})}})})}function loadDefaultSettings(){buildAppInfo();contentAutoHeight({element:".mainContent",scroll:true,drag:false,substract:170,plugin:"slimScroll"})}$(function(){loadDefaultSettings()});